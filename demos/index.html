<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="../src/lib/infusion/src/lib/normalize/css/normalize.css" />
        <link rel="stylesheet" type="text/css" href="../src/lib/infusion/src/framework/core/css/fluid.css" />

        <script src="../src/lib/infusion/infusion-custom.js"></script>
        <script src="../src/lib/d3/d3.js"></script>

        <script src="../src/lib/chartAuthoring/src/js/valueBinding.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/percentage.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/transformations.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/templateInjection.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/d3ViewComponent.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/svgDrawingArea.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/totalRelaying.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/d3Utils.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/utils.js"></script>
        <script src="../src/lib/chartAuthoring/src/js/line.js"></script>

        <script src="../src/js/commitsSummaryPanel.js"></script>
        <script src="../src/js/contributorsSummaryPanel.js"></script>
        <script src="../src/js/jsonp.js"></script>

        <script src="../src/js/baseMetricsPanel.js"></script>
        <script src="../src/js/commitsMetricsPanel.js"></script>
        <script src="../src/js/contributorsMetricsPanel.js"></script>


        <script src="src/js/qi-frontend-demo.js"></script>
        <link rel="stylesheet" type="text/css" href="src/css/qi-frontend-demo.css" />

        <title>QI Frontend Demo</title>
    </head>

    <body>

        <script>
            var params={};window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(str,key,value){params[key] = value;});
            var repo = params.repo;

            // Static examples, good for fast testing
            var sampleCommitsScriptSrc = "../src/js/sampleCommitsCallback.js";
            var sampleContributorsScriptSrc = "../src/js/sampleContributorsCallback.js";
            // Set true to use static example
            var staticMode = false;


            var heading = document.createElement('h1');
            heading.innerHTML = (staticMode === true) ? "gpii/universal" : repo;
            document.write(heading.outerHTML);
        </script>

        <div class="gpiic-commits gpii-panel"></div>

        <div class="gpiic-contributors gpii-panel"></div>

        <script>
            var commitsEndpoint = "http://localhost:3000/a/" + repo + "/commits"

            var contributorsEndpoint = "http://localhost:3000/a/" + repo + "/contributors"

            $(document).ready(function () {
                var commitsMetricsPanel = gpii.qualityInfrastructure.frontEnd.commitsMetricsPanel(".gpiic-commits", {
                    components: {
                        jsonpLoader: {
                            options: {
                                jsonpOptions: {
                                    url: commitsEndpoint
                                }
                            }
                        }
                    }
                });

                var contributorsPanel = gpii.qualityInfrastructure.frontEnd.contributorsMetricsPanel(".gpiic-contributors", {
                    components: {
                        jsonpLoader: {
                            options: {
                                jsonpOptions: {
                                    url: contributorsEndpoint
                                }
                            }
                        }
                    }
                });

                var dayZooms = [30, 60, 180, 365, 730, 1040, 2080];

                var nextMetricsEndDate;

                alterZoom = function() {

                    var currentMetricsEndDate = contributorsPanel.model.currentEventsDataViewSettings.metricsEndDate;

                    console.log(currentMetricsEndDate);
                    nextMetricsEndDate = new Date(currentMetricsEndDate);

                    nextMetricsEndDate.setDate(currentMetricsEndDate.getDate() - 30);

                    console.log(nextMetricsEndDate);

                    commitsMetricsPanel.applier.change("currentEventsDataViewSettings.metricsEndDate", nextMetricsEndDate);

                    contributorsPanel.applier.change("currentEventsDataViewSettings.metricsEndDate", nextMetricsEndDate);

                    // console.log("alterZoom");
                    // console.log(dayZooms);
                    // var zoom = dayZooms.shift();
                    // commitsMetricsPanel.applier.change("currentEventsDataViewSettings.daysBack", zoom);
                    //
                    // contributorsPanel.applier.change("currentEventsDataViewSettings.daysBack", zoom);
                    //
                    // dayZooms.push(zoom);

                }

                var timeoutID = window.setInterval(alterZoom, 3000);

            });



        </script>

    </body>
</html>
